# 前端监控系统

## 什么是前端监控系统

> 背景：在当下互联网行业，监控概念与重要性已经不需要再进行阐述，然而监控分为多种，对物理层（机房，云主机）的监控，对传输链路的监控，对已部署服务的监控等等，而后端的代码通常直接运行在服务器并处于 24 小时实时的监控状态之下，一旦服务的可用性出现问题，SRE 和 DEV 往往在第一时间就会收到告警，并根据告警信息在第一时间解决故障。相比之下，前端代码则运行在客户端上，为了让前端能够和后端一样，需要将客户端的前端代码监控起来，当客户端出现故障时，能第一时间通知到前端负责人，定位故障，及时止损。
> 链接：https://juejin.cn/post/6844903541862039566

用于记录用户在页面中的操作，过程中的 JS 异常，接口异常，性能检查等功能；

## 为什么要有前端监控系统

提到监控系统，大部分同学首先想到的是后端监控。很明显，比如检测服务器性能，数据库性能，API 的访问流量，以及各种服务的运行情况等等，都与后端息息相关。而前端更多承担的是 UI 展现的角色，主要关注页面怎么排版设计，好像没什么需要监测的地方，因此一直以来都没有涉及到监控的概念。
于是呢大家就一致认为：只要后端稳定可控，应用就是稳定可控的，可实际情况真的是这样吗？
近年来，前端发展日益迅猛，得益于 JavaScript 的持续进化和浏览器功能的不断增强，前端能做到的事情越来越多，相应的前端应用的复杂度也越来越高。以前我们压根不会遇到的问题，现在蹭蹭蹭的一股脑都冒出来了。
举个例子，小明是个前端程序员，有一天用户反馈某页面某按钮点了没有反应。小明立刻找到那个按钮，轻轻一点，咦？正常的呀。然后小明又用了几个不同的账号测试，依然是正常的。这下可把小明难倒了。
怎么办？我相信全天下的前端程序员们遇到奇怪问题的反应是一样的。小明这样告诉用户：可能是浏览器缓存问题，不行强制刷新一下，或者退出登录试试？ 用户按照小明的建议操作一番，果然奏效！于是给小明发来了一连串的“感谢 🙏”。小明尴尬一笑，连忙回复“小意思”。
过了两天，又有一个用户反馈了同样的问题。小明又祭出了上面的万能解决大法，依然奏效。可是问题真的解决了吗？没有啊！然而小明尝试过很多遍都无法复现异常，可能原因有很多，比如：

1. 数据问题，可能取不到某个属性

2. 前端问题，JS 代码执行异常

3. 接口问题，可能接口无响应，或没有返回预期的值
   然而正常情况下是没有问题的，小明多次测试也都正常，一定是在某种特定场景下才会出现这个问题，但是我们无法判断，捕捉不到。
   像这类 Bug 潜伏在我们的系统中，仿佛地雷一样，指不定什么时候就会爆。最尴尬的是即便它爆了我们也很难发现，这就导致我们的“排雷行动”困难重重。
   某个阳光明媚的下午，小明坐在马桶上思考人生。突然脑海中一道灵光闪过，小明想到：“如果在用户触发异常的那一刻，系统能自动获取到异常的数据并保存起来，然后在后台的某个地方能看到这些数据，我不就可以立刻找到错误原因了吗？”
   小明一拍大腿，对呀！我怎么没有早点想到呢？这样的话，只要发生异常我们就能自动捕获到异常数据，如果再遇到线上报错，我们不需要用户反馈，自己就可以发现，而且能马上定位错误原因，这不是一举两得？
   我相信许多前端前辈们也曾经被上述的问题所困扰，然后也像小明一样，慢慢的有了这个思路：“将报错时的异常数据存下来供后续排查”。在这个思路不断实践的过程中，逐渐演变成了今天的前端监控。
   当然了，今天的前端监控并不仅仅是监控异常数据，任何有利于产品分析的数据都可以加入监控。所以我认为前端监控，就是指采集用户使用系统过程中产生的关键数据，存储到数据库，后续可以查找和分析，这样的整套实现就被称为前端监控系统。
   链接：https://juejin.cn/post/7096675256986763295
   避免背黑锅，做性能调优，通过分析用户的流量情况，实现一些个性化操作；

## 前端监控系统有什么作用

- 记录用户的操作日志，对于诊断一些问题可以找到出现问题的现场，不用再像以前一样去想尽千方百计复原现场进行测试；
- 解决出现的各种高频问题（大部分用户都出现的问题），通过可视化平台，快速了解问题的所在；
- 记录前端页面各项性能指标，实现性能检测和调优；
- 记录用户对某个页面（功能等）的浏览（使用等）情况，可以通过数据分析来针对用户做一些自定义调节；

## 开启一个前端监控系统

### 前端监控系统-监控的内容

- **性能监控**
  为什么要监控性能呢？因为对于任何一家互联网公司，性能往往与利益直接相关。有数据调查显示：当 Google 延迟 **400ms**时，搜索量下降 **0.59%**、Bing 延迟 **2s**，收入下降 **4.3%**、Yahoo 延迟 **400ms**，流量下降 **5-9%**，所以，很多公司在做用户体验分析时，第一个看的就是性能监控指标，在前端领域，性能无非是以下参考指标：

  - 白屏时间；
  - 首屏时间；
  - 用户可交互时间；
  - 总下载时间；
  - TCP 连接时间；
  - HTTP 请求时间；
  - HTTP 响应时间；
    而且很重要的一点，也是大家往往最容易忽视的：性能会伴随产品的迭代而有所衰减。特别在移动端，网络条件十分不稳定的情况下。性能优化不存在“黄金法则”，我们需要一套性能监控系统持续监控、评估、预警页面性能状况、发现瓶颈，更有针对性的指导优化工作的进行。

- **异常监控**
  除了性能之外，我们还要监控客户端脚本发生的报错，前端报错受网络，机型，业务逻辑影响而且大部分错误难以还原现场，比如我们团队时时收到用户的反馈和投诉：

  - 甲用户 : 点击 XX 按钮之后页面白屏了
  - 乙用户: 优惠劵消费后，支付金额显示不正确
  - 丙用户：最近页面特别卡，点击 tab 好久才能反应过来
    面对用户的反馈，开发经常感到困惑：到底有多卡，哪个步骤卡？是个别现象还是大面积都受到了影响？白屏时页面请求的返回码是多少？是被运行商劫持还是 CDN 出了问题？能让用户用 Charles 配合抓个包么？如何做有针对性的优化？优化的结果怎么去衡量？
    为了解决这些痛点，我们需要对客户端服务进行基于用户行为的监控。

- **数据监控**
  互联网公司的产品，每一个决策，每一个迭代都需要分析各种数据，数据中往往会有我们需要的答案：
  1. 页面 PV,UV 可能直接影响转化率
  2. 从用户访问页面的顺序挖掘使用习惯（等等）

这部分监控数据主要供 PM/PD 使用，业务数据可以驱动业务自身的增长，有人曾说：“要降低创业失败的可能性只有两种方法：一是未卜先知，另一个是做精益的数据分析”，由此可见数据分析的重要性。
